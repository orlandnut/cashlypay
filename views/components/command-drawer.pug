mixin commandDrawer(opts)
  - const options = opts || {};
  - const links = Array.isArray(options.links) ? options.links : [];
  - const actions = Array.isArray(options.actions) ? options.actions : [];
  - const currentPath = options.currentPath || "";
  -
    const defaultLinks = links.length
      ? links
      : [
          { label: "Dashboard", href: "/", match: "/" },
          { label: "Customer Hub", href: "/customers", match: ["/customers", "/management"] },
          { label: "Services", href: "/catalog", match: "/catalog" },
          { label: "Gift Cards", href: "/gift-cards", match: "/gift-cards" },
          { label: "Analytics", href: "/analytics", match: "/analytics" },
          { label: "Reminder Queue", href: "/admin/reminders", match: "/admin" },
          { label: "Payouts", href: "/payouts/console", match: "/payouts" }
        ];
  -
    const defaultActions = actions.length
      ? actions
      : [
          { label: "Create Invoice", href: "/invoice/create", tone: "primary" },
          { label: "Run Reminder Queue", href: "/admin/reminders", tone: "danger", confirm: "Run the reminder queue now?" }
        ];
  -
    const inlineInvoiceAction = defaultActions.find((action) =>
      action.label && action.label.toLowerCase().includes("create invoice")
    );
  -
    const drawerActions = defaultActions.filter((action) => action !== inlineInvoiceAction);

  .command-drawer(id="commandDrawer" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Navigation drawer")
    .command-drawer__panel
      .command-drawer__header
        .command-drawer__brand
          a.command-drawer__brand-lockup(href="/")
            span.sr-only CashlyPay home
            .brand-chip.brand-chip--drawer.command-drawer__brand-chip
              .brand-chip__icon
                img(src="/images/cashly-logo.png" alt="CashlyPay mark" width="48" height="48" loading="lazy" decoding="async")
              .brand-chip__body
                span.brand-chip__eyebrow CashlyPay OS
                .wordmark.wordmark--drawer
                  span.wordmark__main Cashly
                  span.wordmark__accent Pay
                  span.wordmark__signal
                span.brand-chip__meta Navigate & automate
              .brand-chip__badge
                span.brand-chip__badge-text Finance OS
                span.brand-chip__status-bar
                span.brand-chip__pulse
        button.command-drawer__close(type="button" aria-label="Close navigation panel")
          span
      nav.command-drawer__nav
        ul
          each link in defaultLinks
            -
              const matchTarget = link.match || link.href;
              const matches = Array.isArray(matchTarget) ? matchTarget : [matchTarget];
              const isActive = matches.some((target) =>
                target ? currentPath === target || currentPath.startsWith(target) : false
              );
            li
              .command-drawer__nav-row
                a(class=isActive ? 'active' : '' href=link.href)= link.label
                if inlineInvoiceAction && link.label === "Invoices"
                  a.command-drawer__inline-action.button.button-secondary.button-sm(href=inlineInvoiceAction.href)= inlineInvoiceAction.label
      if drawerActions.length
        .command-drawer__actions
          each action in drawerActions
            - const tone = action.tone || "primary";
            - let btnClass = "button button-primary";
            - if (tone === "secondary") btnClass = "button button-secondary";
            - else if (tone === "ghost") btnClass = "button button-ghost";
            - else if (tone === "danger") btnClass = "button button-danger";
            a(class=btnClass href=action.href data-confirm=action.confirm || null)= action.label
