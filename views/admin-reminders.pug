extends layout

block hero
  +darkHero({
    title: "Reminder Queue",
    subtitle: "Monitor scheduled nudges and process overdue reminders from a single place.",
    actions: [
      { type: "primary", label: "Process Now", href: "/admin/reminders/run" },
      { type: "secondary", label: "Dashboard", href: "/" }
    ]
  })


block content
  .dashboard
    section.section.panel
      .section-header
        h3.section-title Reminder Queue
        form(action="/admin/reminders/run" method="post")
          button.button.button-secondary(type="submit") Process Now
      if reminders && reminders.length
        .reminder-card-list
          each reminder in reminders
            - const statusVariant = reminder.type === 'UPCOMING_DUE' ? 'live' : 'alert';
            - const scheduleLabel = new Date(reminder.runAt).toLocaleString();
            - const reminderLink = `/invoice/view/${reminder.locationId || locationId}/${reminder.customerId || ''}/${reminder.invoiceId}`;
            .reminder-card
              .reminder-card__header
                .reminder-card__status(class=`reminder-card__status--${statusVariant}`)
                  span.status-dot
                  span #{reminder.type.replace('_', ' ')}
                .reminder-card__timestamp
                  span.label Scheduled
                  span.value #{scheduleLabel}
              .reminder-card__meta-grid
                .reminder-card__meta
                  span.label Invoice
                  span.value #{reminder.invoiceId}
                .reminder-card__meta
                  span.label Attempts
                  span.value #{reminder.attempts || 0}
                if reminder.customerId
                  .reminder-card__meta
                    span.label Customer
                    span.value #{reminder.customerId}
                if reminder.locationId
                  .reminder-card__meta
                    span.label Location
                    span.value #{reminder.locationId}
              .reminder-card__actions
                a.button.button-secondary.button-sm(href=reminderLink) Review invoice
      else
        p.text-secondary No reminders scheduled.
      .table-footer
        a.button.button-ghost(href="/admin/reminders") Refresh List
